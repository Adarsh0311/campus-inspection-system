<div *ngIf="isLoading">Loading building data...</div>

<div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

<div *ngIf="!isLoading && !errorMessage">
  <h2>Edit Building</h2>
  <form (ngSubmit)="handleSaveChanges()" #buildingForm="ngForm" class="card p-4">
    <div class="card bg-light p-3 mb-3">
      <h4>Building Details</h4>
      <div class="row">
        <div class="mb-3 col-md-6 col-lg-6">
          <label for="buildingName" class="form-label">Building Name</label>
          <input type="text" class="form-control" id="buildingName" [(ngModel)]="buildingName" name="buildingName"
            required>
        </div>
        <div class="mb-3 col-md-6 col-lg-6">
          <label for="buildingLocation" class="form-label">Location</label>
          <input type="text" class="form-control" id="buildingLocation" [(ngModel)]="buildingLocation"
            name="buildingLocation">
        </div>
      </div>
    </div>


    <div class="card bg-light p-3 mb-3">
      <h4>Inspection Checklist</h4>
      <ul class="list-group mb-3">
        <li *ngFor="let item of checklistItems; let i = index; trackBy: trackByItemId" class="list-group-item">
          <div class="row align-items-center">
            <div class="col-md-7">
              <label class="form-label visually-hidden">Question</label>
              <input type="text" class="form-control" [ngModel]="item.question"
                (ngModelChange)="handleItemChange(i, 'question', $event)" [name]="'question-' + i">
            </div>
            <div class="col-md-3">
              <label class="form-label visually-hidden">Type</label>
              <select class="form-select" [ngModel]="item.type" (ngModelChange)="handleItemChange(i, 'type', $event)"
                [name]="'type-' + i">
                <option value="BOOLEAN">Yes/No</option>
                <option value="NUMERIC">Number</option>
                <option value="TEXT">Text</option>
              </select>
            </div>
            <div class="col-md-2 d-grid">
              <button type="button" class="btn btn-sm btn-outline-danger" (click)="handleRemoveItem(i)">Remove</button>
            </div>
          </div>
        </li>
        <li *ngIf="checklistItems.length === 0" class="list-group-item text-muted">No checklist items yet.</li>
      </ul>
    </div>

    <div class="card bg-light p-3 mb-3">
      <h5>Add New Item</h5>
      <div class="row g-3 align-items-end">
        <div class="col-md-6">
          <label for="newQuestion" class="form-label">Question</label>
          <input type="text" class="form-control" id="newQuestion" [(ngModel)]="newQuestion" name="newQuestion">
        </div>
        <div class="col-md-4">
          <label for="newQuestionType" class="form-label">Type</label>
          <select id="newQuestionType" class="form-select" [(ngModel)]="newQuestionType" name="newQuestionType">
            <option value="BOOLEAN">Yes/No</option>
            <option value="NUMERIC">Number</option>
            <option value="TEXT">Text</option>
          </select>
        </div>
        <div class="col-md-2 d-grid">
          <button type="button" class="btn btn-secondary" (click)="handleAddItem()">Add Item</button>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-end">
      <button type="button" class="btn btn-outline-secondary me-2"
        (click)="router.navigate(['/buildings'])">Cancel</button>
      <button type="submit" class="btn btn-primary" [disabled]="buildingForm.invalid">Save Changes</button>
    </div>
  </form>
</div>